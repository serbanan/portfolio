<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notebook – Andrei Serban</title>
  <link rel="stylesheet" href="styles/styles.css" />
  <style>
    .admin-bar { margin-bottom: 1em; }
    .admin-bar input, .admin-bar button { font-size: 1rem; }
    .notebook-entry { border-bottom: 1px solid #eee; padding-bottom: 1em; margin-bottom: 2em;}
    .notebook-entry:last-child { border-bottom: none; }
    .add-entry-form textarea, .add-entry-form input[type="date"] {
      width: 100%; font-size: 1rem; margin-bottom: 0.5em; border-radius: 3px; border: 1px solid #ccc; padding: 0.4em;
    }
    .add-entry-form { margin-bottom: 2em;}
    .site-footer { margin-top: 2em;}
    .footer-link { color: #1976d2; }
    .footer-link:hover { color: #ff5a36; text-decoration: underline; }
  </style>
  <!-- Firebase App (the core Firebase SDK) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, push } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB23xnOjqNpv0magsyjZzBNtaqW3HclzMM",
      authDomain: "andrei-notebook.firebaseapp.com",
      databaseURL: "https://andrei-notebook-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "andrei-notebook",
      storageBucket: "andrei-notebook.firebasestorage.app",
      messagingSenderId: "387476994719",
      appId: "1:387476994719:web:2956b9bee3f0a39017c0aa",
      measurementId: "G-KD7WV5CYYJ"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- Admin password logic (client-side demo only) ---
    const ADMIN_PASS = "letmein";
    let isAdmin = false;

    // --- UI Elements ---
    window.addEventListener('DOMContentLoaded', () => {
      const adminBar = document.getElementById('admin-bar');
      const adminLoginForm = document.getElementById('admin-login-form');
      const adminPassword = document.getElementById('admin-password');
      const adminLogoutBtn = document.getElementById('admin-logout-btn');
      const addEntrySection = document.getElementById('add-entry-section');
      const addEntryForm = document.getElementById('add-entry-form');
      const entryDate = document.getElementById('entry-date');
      const entryText = document.getElementById('entry-text');
      const notebookEntries = document.getElementById('notebook-entries');

      // --- Login/logout logic ---
      adminLoginForm.onsubmit = e => {
        e.preventDefault();
        if (adminPassword.value === ADMIN_PASS) {
          isAdmin = true;
          adminLoginForm.style.display = 'none';
          adminLogoutBtn.style.display = '';
          addEntrySection.style.display = '';
        } else {
          alert("Wrong password");
        }
        adminPassword.value = '';
      };
      adminLogoutBtn.onclick = () => {
        isAdmin = false;
        adminLoginForm.style.display = '';
        adminLogoutBtn.style.display = 'none';
        addEntrySection.style.display = 'none';
      };

      // --- Render entries ---
      function renderEntries(entries) {
        notebookEntries.innerHTML = '';
        // Sort entries by date desc
        entries.sort((a, b) => b.date.localeCompare(a.date));
        entries.forEach(entry => {
          const art = document.createElement('article');
          art.className = "notebook-entry";
          art.innerHTML = `<h2>${entry.date}</h2>
                           <p>${(entry.text || '').replace(/\n/g,'<br>')}</p>`;
          notebookEntries.appendChild(art);
        });
      }

      // --- Listen for entries ---
      onValue(ref(db, "notebookEntries"), snapshot => {
        const data = snapshot.val() || {};
        const entries = Object.values(data);
        renderEntries(entries);
      });

      // --- Add entry (admin only) ---
      addEntryForm.onsubmit = function(e) {
        e.preventDefault();
        const date = entryDate.value;
        const text = entryText.value.trim();
        if (!date || !text) return;
        push(ref(db, "notebookEntries"), {date, text});
        entryText.value = '';
        entryDate.value = '';
      };

      // --- Prefill today's date ---
      entryDate.value = new Date().toISOString().slice(0,10);
    });
  </script>
</head>
<body>
  <div class="notebook-container">
    <header class="notebook-header">
      <a href="index.html" class="footer-link" style="font-size:1.2rem;">← Back to Portfolio</a>
      <h1>Notebook</h1>
      <p class="notebook-description">A journal of thoughts and daily entries.</p>
    </header>
    <div class="admin-bar" id="admin-bar">
      <form id="admin-login-form" style="display:inline;">
        <input type="password" id="admin-password" placeholder="Admin password" autocomplete="current-password" />
        <button type="submit">Login</button>
      </form>
      <button id="admin-logout-btn" style="display:none;">Log out</button>
    </div>
    <div id="add-entry-section" style="display:none;">
      <form id="add-entry-form" class="add-entry-form">
        <input type="date" id="entry-date" required />
        <textarea id="entry-text" rows="3" required placeholder="Your notebook entry..."></textarea>
        <br>
        <button type="submit">Add Entry</button>
      </form>
    </div>
    <section class="notebook-entries" id="notebook-entries"></section>
  </div>
  <footer class="site-footer">
    <a href="notebook.html" class="footer-link">Notebook</a>
  </footer>
</body>
</html>